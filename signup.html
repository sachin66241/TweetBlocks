<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Sign up to slateMe</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/eosjs@16.0.0/lib/eos.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/eosjs@16.0.0/lib/eos.min.js"></script>
    <script src="js/scatter.min.js"></script>
    <script src="js/main.js"></script>
    <link rel="stylesheet" href="css/edit.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <label>USER NAME: </label>
    <input id="userName" type="text"><br><br>

    <label>DOB: </label>
    <input type="date" id="myDate" ><br><br>

    <!-- <label> PHONE:</label>    
    <select id ="stdCode" style="max-width:25%;">
        <option id="IN" value="+91-" Selected>India (+91)</option>
        <option id="GB" value="+44-" >UK (+44)</option>
        <optgroup label="Other countries" >
            <option id="DZ" value="+213-">Algeria (+213)</option>
            <option id="AD" value="+376-">Andorra (+376)</option>
            <option id="AO" value="+244-">Angola (+244)</option>
            <option id="AI" value="+1264-">Anguilla (+1264)</option>
            <option id="AG" value="+1268-">Antigua &amp; Barbuda (+1268)</option>
            <option id="AR" value="+54-">Argentina (+54)</option>
            <option id="AM" value="+374-">Armenia (+374)</option>
            <option id="AW" value="+297-">Aruba (+297)</option>
            <option id="AU" value="+61-">Australia (+61)</option>
            <option id="AT" value="+43-">Austria (+43)</option>
            <option id="AZ" value="+994-">Azerbaijan (+994)</option>
            <option id="BS" value="+1242-">Bahamas (+1242)</option>
            <option id="BH" value="+973-">Bahrain (+973)</option>
            <option id="BD" value="+880-">Bangladesh (+880)</option>
            <option id="BB" value="+1246-">Barbados (+1246)</option>
            <option id="BY" value="+375-">Belarus (+375)</option>
            <option id="BE" value="+32-">Belgium (+32)</option>
            <option id="BZ" value="+501-">Belize (+501)</option>
            <option id="BJ" value="+229-">Benin (+229)</option>
            <option id="BM" value="+1441-">Bermuda (+1441)</option>
            <option id="BT" value="+975-">Bhutan (+975)</option>
            <option id="BO" value="+591-">Bolivia (+591)</option>
            <option id="BA" value="+387-">Bosnia Herzegovina (+387)</option>
            <option id="BW" value="+267-">Botswana (+267)</option>
            <option id="BR" value="+55-">Brazil (+55)</option>
            <option id="BN" value="+673-">Brunei (+673)</option>
            <option id="BG" value="+359-">Bulgaria (+359)</option>
            <option id="BF" value="+226-">Burkina Faso (+226)</option>
            <option id="BI" value="+257-">Burundi (+257)</option>
            <option id="KH" value="+855-">Cambodia (+855)</option>
            <option id="CM" value="+237-">Cameroon (+237)</option>
            <option id="CA" value="+1-">Canada (+1)</option>
            <option id="CV" value="+238-">Cape Verde Islands (+238)</option>
            <option id="KY" value="+1345-">Cayman Islands (+1345)</option>
            <option id="CF" value="+236-">Central African Republic (+236)</option>
            <option id="CL" value="+56-">Chile (+56)</option>
            <option id="CN" value="+86-">China (+86)</option>
            <option id="CO" value="+57-">Colombia (+57)</option>
            <option id="KM" value="+269-">Comoros (+269)</option>
            <option id="CG" value="+242-">Congo (+242)</option>
            <option id="CK" value="+682-">Cook Islands (+682)</option>
            <option id="CR" value="+506-">Costa Rica (+506)</option>
            <option id="HR" value="+385-">Croatia (+385)</option>
            <option id="CU" value="+53-">Cuba (+53)</option>
            <option id="CY" value="+90392-">Cyprus North (+90392)</option>
            <option id="CY" value="+357-">Cyprus South (+357)</option>
            <option id="CZ" value="+42-">Czech Republic (+42)</option>
            <option id="DK" value="+45-">Denmark (+45)</option>
            <option id="DJ" value="+253-">Djibouti (+253)</option>
            <option id="DM" value="+1809-">Dominica (+1809)</option>
            <option id="DO" value="+1809-">Dominican Republic (+1809)</option>
            <option id="EC" value="+593-">Ecuador (+593)</option>
            <option id="EG" value="+20-">Egypt (+20)</option>
            <option id="SV" value="+503-">El Salvador (+503)</option>
            <option id="GQ" value="+240-">Equatorial Guinea (+240)</option>
            <option id="ER" value="+291-">Eritrea (+291)</option>
            <option id="EE" value="+372-">Estonia (+372)</option>
            <option id="ET" value="+251-">Ethiopia (+251)</option>
            <option id="FK" value="+500-">Falkland Islands (+500)</option>
            <option id="FO" value="+298-">Faroe Islands (+298)</option>
            <option id="FJ" value="+679-">Fiji (+679)</option>
            <option id="FI" value="+358-">Finland (+358)</option>
            <option id="FR" value="+33-">France (+33)</option>
            <option id="GF" value="+594-">French Guiana (+594)</option>
            <option id="PF" value="+689-">French Polynesia (+689)</option>
            <option id="GA" value="+241-">Gabon (+241)</option>
            <option id="GM" value="+220-">Gambia (+220)</option>
            <option id="GE" value="+7880-">Georgia (+7880)</option>
            <option id="DE" value="+49-">Germany (+49)</option>
            <option id="GH" value="+233-">Ghana (+233)</option>
            <option id="GI" value="+350-">Gibraltar (+350)</option>
            <option id="GR" value="+30-">Greece (+30)</option>
            <option id="GL" value="+299-">Greenland (+299)</option>
            <option id="GD" value="+1473-">Grenada (+1473)</option>
            <option id="GP" value="+590-">Guadeloupe (+590)</option>
            <option id="GU" value="+671-">Guam (+671)</option>
            <option id="GT" value="+502-">Guatemala (+502)</option>
            <option id="GN" value="+224-">Guinea (+224)</option>
            <option id="GW" value="+245-">Guinea - Bissau (+245)</option>
            <option id="GY" value="+592-">Guyana (+592)</option>
            <option id="HT" value="+509-">Haiti (+509)</option>
            <option id="HN" value="+504-">Honduras (+504)</option>
            <option id="HK" value="+852-">Hong Kong (+852)</option>
            <option id="HU" value="+36-">Hungary (+36)</option>
            <option id="IS" value="+354-">Iceland (+354)</option>
            <option id="IN" value="+91-">India (+91)</option>
            <option id="ID" value="+62-">Indonesia (+62)</option>
            <option id="IR" value="+98-">Iran (+98)</option>
            <option id="IQ" value="+964-">Iraq (+964)</option>
            <option id="IE" value="+353-">Ireland (+353)</option>
            <option id="IL" value="+972-">Israel (+972)</option>
            <option id="IT" value="+39-">Italy (+39)</option>
            <option id="JM" value="+1876-">Jamaica (+1876)</option>
            <option id="JP" value="+81-">Japan (+81)</option>
            <option id="JO" value="+962-">Jordan (+962)</option>
            <option id="KZ" value="+7-">Kazakhstan (+7)</option>
            <option id="KE" value="+254-">Kenya (+254)</option>
            <option id="KI" value="+686-">Kiribati (+686)</option>
            <option id="KP" value="+850-">Korea North (+850)</option>
            <option id="KR" value="+82-">Korea South (+82)</option>
            <option id="KW" value="+965-">Kuwait (+965)</option>
            <option id="KG" value="+996-">Kyrgyzstan (+996)</option>
            <option id="LA" value="+856-">Laos (+856)</option>
            <option id="LV" value="+371-">Latvia (+371)</option>
            <option id="LB" value="+961-">Lebanon (+961)</option>
            <option id="LS" value="+266-">Lesotho (+266)</option>
            <option id="LR" value="+231-">Liberia (+231)</option>
            <option id="LY" value="+218-">Libya (+218)</option>
            <option id="LI" value="+417-">Liechtenstein (+417)</option>
            <option id="LT" value="+370-">Lithuania (+370)</option>
            <option id="LU" value="+352-">Luxembourg (+352)</option>
            <option id="MO" value="+853-">Macao (+853)</option>
            <option id="MK" value="+389-">Macedonia (+389)</option>
            <option id="MG" value="+261-">Madagascar (+261)</option>
            <option id="MW" value="+265-">Malawi (+265)</option>
            <option id="MY" value="+60-">Malaysia (+60)</option>
            <option id="MV" value="+960-">Maldives (+960)</option>
            <option id="ML" value="+223-">Mali (+223)</option>
            <option id="MT" value="+356-">Malta (+356)</option>
            <option id="MH" value="+692-">Marshall Islands (+692)</option>
            <option id="MQ" value="+596-">Martinique (+596)</option>
            <option id="MR" value="+222-">Mauritania (+222)</option>
            <option id="YT" value="+269-">Mayotte (+269)</option>
            <option id="MX" value="+52-">Mexico (+52)</option>
            <option id="FM" value="+691-">Micronesia (+691)</option>
            <option id="MD" value="+373-">Moldova (+373)</option>
            <option id="MC" value="+377-">Monaco (+377)</option>
            <option id="MN" value="+976-">Mongolia (+976)</option>
            <option id="MS" value="+1664-">Montserrat (+1664)</option>
            <option id="MA" value="+212-">Morocco (+212)</option>
            <option id="MZ" value="+258-">Mozambique (+258)</option>
            <option id="MN" value="+95-">Myanmar (+95)</option>
            <option id="NA" value="+264-">Namibia (+264)</option>
            <option id="NR" value="+674-">Nauru (+674)</option>
            <option id="NP" value="+977-">Nepal (+977)</option>
            <option id="NL" value="+31-">Netherlands (+31)</option>
            <option id="NC" value="+687-">New Caledonia (+687)</option>
            <option id="NZ" value="+64-">New Zealand (+64)</option>
            <option id="NI" value="+505-">Nicaragua (+505)</option>
            <option id="NE" value="+227-">Niger (+227)</option>
            <option id="NG" value="+234-">Nigeria (+234)</option>
            <option id="NU" value="+683-">Niue (+683)</option>
            <option id="NF" value="+672-">Norfolk Islands (+672)</option>
            <option id="NP" value="+670-">Northern Marianas (+670)</option>
            <option id="NO" value="+47-">Norway (+47)</option>
            <option id="OM" value="+968-">Oman (+968)</option>
            <option id="PW" value="+680-">Palau (+680)</option>
            <option id="PA" value="+507-">Panama (+507)</option>
            <option id="PG" value="+675-">Papua New Guinea (+675)</option>
            <option id="PY" value="+595-">Paraguay (+595)</option>
            <option id="PE" value="+51-">Peru (+51)</option>
            <option id="PH" value="+63-">Philippines (+63)</option>
            <option id="PL" value="+48-">Poland (+48)</option>
            <option id="PT" value="+351-">Portugal (+351)</option>
            <option id="PR" value="+1787-">Puerto Rico (+1787)</option>
            <option id="QA" value="+974-">Qatar (+974)</option>
            <option id="RE" value="+262-">Reunion (+262)</option>
            <option id="RO" value="+40-">Romania (+40)</option>
            <option id="RU" value="+7-">Russia (+7)</option>
            <option id="RW" value="+250-">Rwanda (+250)</option>
            <option id="SM" value="+378-">San Marino (+378)</option>
            <option id="ST" value="+239-">Sao Tome &amp; Principe (+239)</option>
            <option id="SA" value="+966-">Saudi Arabia (+966)</option>
            <option id="SN" value="+221-">Senegal (+221)</option>
            <option id="CS" value="+381-">Serbia (+381)</option>
            <option id="SC" value="+248-">Seychelles (+248)</option>
            <option id="SL" value="+232-">Sierra Leone (+232)</option>
            <option id="SG" value="+65-">Singapore (+65)</option>
            <option id="SK" value="+421-">Slovak Republic (+421)</option>
            <option id="SI" value="+386-">Slovenia (+386)</option>
            <option id="SB" value="+677-">Solomon Islands (+677)</option>
            <option id="SO" value="+252-">Somalia (+252)</option>
            <option id="ZA" value="+27-">South Africa (+27)</option>
            <option id="ES" value="+34-">Spain (+34)</option>
            <option id="LK" value="+94-">Sri Lanka (+94)</option>
            <option id="SH" value="+290-">St. Helena (+290)</option>
            <option id="KN" value="+1869-">St. Kitts (+1869)</option>
            <option id="SC" value="+1758-">St. Lucia (+1758)</option>
            <option id="SD" value="+249-">Sudan (+249)</option>
            <option id="SR" value="+597-">Suriname (+597)</option>
            <option id="SZ" value="+268-">Swaziland (+268)</option>
            <option id="SE" value="+46-">Sweden (+46)</option>
            <option id="CH" value="+41-">Switzerland (+41)</option>
            <option id="SI" value="+963-">Syria (+963)</option>
            <option id="TW" value="+886-">Taiwan (+886)</option>
            <option id="TJ" value="+7-">Tajikstan (+7)</option>
            <option id="TH" value="+66-">Thailand (+66)</option>
            <option id="TG" value="+228-">Togo (+228)</option>
            <option id="TO" value="+676-">Tonga (+676)</option>
            <option id="TT" value="+1868-">Trinidad &amp; Tobago (+1868)</option>
            <option id="TN" value="+216-">Tunisia (+216)</option>
            <option id="TR" value="+90-">Turkey (+90)</option>
            <option id="TM" value="+7-">Turkmenistan (+7)</option>
            <option id="TM" value="+993-">Turkmenistan (+993)</option>
            <option id="TC" value="+1649-">Turks &amp; Caicos Islands (+1649)</option>
            <option id="TV" value="+688-">Tuvalu (+688)</option>
            <option id="UG" value="+256-">Uganda (+256)</option>
            <!-- <option id="GB" value="44">UK (+44)</option> -->
          

    <!-- <input type="text" id="phone"><br><br>
    <br><br> -->
    <br>GENDER:<br>
    <select id="genSelect">
        <option value="male" selected>Male</option> // Pre-selected
        <option value="female">Female</option>
        <option value="others">Others</option>
    </select><br><br>

    <label>PROFILE IMAGE: </label><br>
    <img id="img" src="http://127.0.0.1:5500/images/maledefault.jpg" width="100" height="100"></h1><br><br>
    <button id="myBtn">BROWSE</button>
    <button id="remvBtn" onclick="removeImage()">Remove Profile Pic</button>

    <!-- The Modal -->
    <div id="myModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2>SELECT YOUR AVATAR</h2>
            </div>
            <div class="modal-body">
                <img src="images/2.png" alt="Avatar" id="2.png" onclick="selectImage(this)" class="avatar">
                <img src="images/3.png" alt="Avatar" id="3.png" onclick="selectImage(this)" class="avatar">
                <img src="images/4.png" alt="Avatar" id="4.png" onclick="selectImage(this)" class="avatar">
                <img src="images/5.png" alt="Avatar" id="5.png" onclick="selectImage(this)" class="avatar">
                <img src="images/6.png" alt="Avatar" id="6.png" onclick="selectImage(this)" class="avatar">
                <img src="images/7.png" alt="Avatar" id="7.png" onclick="selectImage(this)" class="avatar">
                <img src="images/8.png" alt="Avatar" id="8.png" onclick="selectImage(this)" class="avatar">
                <img src="images/9.png" alt="Avatar" id="9.png" onclick="selectImage(this)" class="avatar">
                <img src="images/10.png" alt="Avatar" id="10.png" onclick="selectImage(this)" class="avatar">
                <img src="images/11.png" alt="Avatar" id="11.png" onclick="selectImage(this)" class="avatar">
                <img src="images/12.png" alt="Avatar" id="12.png" onclick="selectImage(this)" class="avatar">
                <img src="images/13.png" alt="Avatar" id="13.png" onclick="selectImage(this)" class="avatar">
                <img src="images/14.png" alt="Avatar" id="14.png" onclick="selectImage(this)" class="avatar">
                <img src="images/15.png" alt="Avatar" id="15.png" onclick="selectImage(this)" class="avatar">
                <img src="images/16.png" alt="Avatar" id="16.png" onclick="selectImage(this)" class="avatar">
                <img src="images/17.png" alt="Avatar" id="17.png" onclick="selectImage(this)" class="avatar">
            </div>
            <div class="modal-footer">
                <h3></h3>
            </div>
        </div>
    </div>
         
    <br><br>
    <input type="button" value="Submit" onclick="signUp()"><br>

    <script>
        var myDate= Date.now();
        var dob1= converttime(myDate);
        var dob2=dob1.split(",");
        var dob3=dob2[0].split("/");
        var dob4=dob3[2]+"-"+dob3[1]+"-"+dob3[0];
        $('#myDate').attr("value", dob4);
        var modal = document.getElementById('myModal');

        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        var im = document.getElementById("img");
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks the button, open the modal 
        btn.onclick = function() {
            modal.style.display = "block";
        }

        im.onclick = function() {
            modal.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
        var imageUrl="";
        $("#genSelect").change(function(){
            imageUrl = $("#img").attr("src");
            if(imageUrl == "http://127.0.0.1:5500/images/femaledefault.jpg" || imageUrl == "http://127.0.0.1:5500/images/maledefault.jpg" || imageUrl == "http://127.0.0.1:5500/images/othersdefault.jpg")  removeImage();

        });
        
        function removeImage(){
            imageUrl="";
            var gender = $("#genSelect").val();
            if(gender == "female")  $("#img").attr("src","http://127.0.0.1:5500/images/femaledefault.jpg");
            else if(gender == "male")   $("#img").attr("src","http://127.0.0.1:5500/images/maledefault.jpg");
            else $("#img").attr("src","http://127.0.0.1:5500/images/othersdefault.jpg");
        }

        function selectImage(img){
            imageUrl = img.id;  
            modal.style.display = "none";        
            $("#img").attr("src","images/"+imageUrl);
            $("#img").attr("class","avatar");
        }

        function signUp(){
            if($("#userName").val()==''){
                alert("Enter User Name");
                console.log("usename needed");
                return;
            }
            var network = {
                protocol:'https', 
                blockchain:'eos',
                host:'api.jungle.alohaeos.com',
                port:443,
                chainId:"038f4b0fc8ff18a4f0842a8f0564611f6e96e8535901dd45e43ac8691a1c4dca",
            };
            if(scatter.identity != undefined){
                scatter.forgetIdentity().then(function(){
                    scatter.getIdentity({accounts:[network]}).then(function(res){
                        account = res.accounts.find(function(x){ return x.blockchain === 'eos' });
                        options = {
                            authorization: [ `${account.name}@${account.authority}`]
                        };
                        eos = scatter.eos(network, Eos, options);
                        eos.contract('slatemelate1').then(contract => {
                            var accName = account.name;
                            var userName = $("#userName").val();
                            var dob = convertDate($("#myDate").val());
                            var ph = $("#stdCode").val()+$("#phone").val();
                            var gen = $("#genSelect").val();
                            contract.signup({accName:accName,userName:userName,phoneNo:00,gender:gen,dob:dob,profilepic:imageUrl},options).then(function(res){
                                console.log('res', res);
                                window.location.replace("http://127.0.0.1:5500/home.html")
                                
                            }).catch(function(err){
                                console.log('err', err);
                                alert("Account is already signed up with Scatter");
                            });
                        });
                    })
                })
            }
            else {
                scatter.getIdentity({accounts:[network]}).then(function(res){
                    account = res.accounts.find(function(x){ return x.blockchain === 'eos' });
                    options = {
                        authorization: [ `${account.name}@${account.authority}`]
                    };
                    eos = scatter.eos(network, Eos, options);
                    eos.contract('slatemelate1').then(contract => {
                        var accName = account.name;
                        var userName = $("#userName").val();
                        var dob = convertDate($("#myDate").val());
                        var ph = $("#stdCode").val()+$("#phone").val();
                        var gen = $("#genSelect").val();

                        contract.signup({accName:accName,userName:userName,phoneNo:ph,gender:gen,dob:dob,profilepic:imageUrl},options).then(function(res){
                            window.location.replace("http://127.0.0.1:5500/home.html")
                            console.log('res', res);
                        }).catch(function(err){
                            console.log('err', err);
                            alert("Account is already signup with Scatter");
                        });
                    });
                })
            }
        }
    </script>
</body>
</html>