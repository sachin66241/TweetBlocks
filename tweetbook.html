<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/eosjs@16.0.0/lib/eos.min.js"></script>
    <script src="dist/scatter.min.js"></script>
    <script src="main.js"></script>
    <title>Document</title>
    <button onclick="signOut()">SIGN OUT</button>
    <p id="demo"></p>
</head>
<body>
    <script>
         scatter.connect("TestPage").then(function(connected){
  console.log('connected', connected);

         network = {
            protocol:'http', 
            blockchain:'eos',
            host:'52.199.125.75',
            port:8888,
            chainId:"038f4b0fc8ff18a4f0842a8f0564611f6e96e8535901dd45e43ac8691a1c4dca",
        };
         const requiredFields = {
             personal:['firstname','lastname'],
             accounts:[network]
         };
            
          var bell="";
          scatter.getIdentity(requiredFields).then(function(id){
          account = id.accounts.find(function(x){ return x.blockchain === 'eos' });
          console.log('acc', account);
          bell=id.accounts[0].name;
        
          

            var data = JSON.stringify({
              "scope": bell,
              "code": "twitternew12",
              "table": "account",
              "limit": 50,
              "json": "true"
            });
          
          
          var xhr = new XMLHttpRequest();
          xhr.withCredentials = false;
          
          xhr.addEventListener("readystatechange", function () {
                if (this.readyState === this.DONE) {
                  var bal = JSON.parse(this.responseText);
                  console.log(bal);
                  
                  var userName=bal.rows[0].userName; 
                  var followersCount=(bal.rows[0].followers);
                  var followingCount=(bal.rows[0].following);
                  var tweetCount=(bal.rows[0].tweetId.length);
                  
                  if(tweetCount>0){
          
                    tweets(bal.rows[0].tweetId);
          
                  }
          
                  else{
          
                    console.log("No Tweets Yet !!!!");
          
                  }
             
              }
            
          });
          
          xhr.open("POST", "http://52.199.125.75:8888/v1/chain/get_table_rows");
          xhr.send(data);
          
          
          
          function tweets(tweetIndex){
          
            //console.log(tweetIndex);
          
            for (var index = 0; index < tweetIndex.length; index++) {
          
          
              var data = JSON.stringify({
                "scope": tweetIndex[index],
                "code": "twitternew12",
                "table": "tweettable",
                "limit": 50,
                "json": "true"
              });
            
            
            var xhr = new XMLHttpRequest();
            xhr.withCredentials = false;
            
            xhr.addEventListener("readystatechange", function () {
                  if (this.readyState === this.DONE) {
                    var bal = JSON.parse(this.responseText);
                    console.log(bal);

                    
                    //document.getElementById("demo").innerHTML=bal.rows[0].msg;
                    //alert(bal.rows[0].msg);

                    var iDiv = document.createElement('div');
                    var idiv1 = document.createElement('div');
                    var idiv2 = document.createElement('div');

                    //iDiv.id = 'block';
                    //iDiv.className = 'block';
                    idiv1.innerHTML = bal.rows[0].msg;
                    idiv2.innerHTML= bal.rows[0].timestamp;
                    iDiv.appendChild(idiv1);
                    iDiv.appendChild(idiv2);
                    document.getElementsByTagName('body')[0].appendChild(iDiv);
                    
                    
                }
            });
            xhr.open("POST", "http://52.199.125.75:8888/v1/chain/get_table_rows");
            xhr.send(data);
              
              
            }
          
          }
        }).catch(function(x){
        console.log('x', x);
    });
}).catch(function(x){
  console.log('x', x);
});

          </script>
    
</body>
</html>